function cov_9z7cltjdy(){var path="/Users/lisboa/Downloads/commercetools-api-load-testing/data-generation/src/cart-discounts/importer.js";var hash="ff7acf481b0eb2d0bf7ef01d6c65bbd89983cb3c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/lisboa/Downloads/commercetools-api-load-testing/data-generation/src/cart-discounts/importer.js",statementMap:{"0":{start:{line:1,column:20},end:{line:1,column:46}},"1":{start:{line:2,column:37},end:{line:2,column:64}},"2":{start:{line:3,column:20},end:{line:3,column:40}},"3":{start:{line:4,column:15},end:{line:4,column:47}},"4":{start:{line:5,column:27},end:{line:5,column:50}},"5":{start:{line:6,column:35},end:{line:6,column:61}},"6":{start:{line:7,column:23},end:{line:7,column:43}},"7":{start:{line:8,column:15},end:{line:8,column:39}},"8":{start:{line:10,column:20},end:{line:14,column:1}},"9":{start:{line:11,column:2},end:{line:13,column:3}},"10":{start:{line:17,column:20},end:{line:17,column:30}},"11":{start:{line:19,column:17},end:{line:19,column:49}},"12":{start:{line:20,column:27},end:{line:20,column:57}},"13":{start:{line:21,column:2},end:{line:21,column:52}},"14":{start:{line:21,column:29},end:{line:21,column:52}},"15":{start:{line:23,column:2},end:{line:23,column:73}},"16":{start:{line:24,column:16},end:{line:26,column:3}},"17":{start:{line:28,column:2},end:{line:28,column:46}},"18":{start:{line:30,column:2},end:{line:30,column:76}},"19":{start:{line:31,column:2},end:{line:31,column:79}},"20":{start:{line:33,column:2},end:{line:33,column:64}},"21":{start:{line:34,column:18},end:{line:34,column:28}},"22":{start:{line:35,column:2},end:{line:37,column:3}},"23":{start:{line:39,column:2},end:{line:39,column:14}},"24":{start:{line:43,column:2},end:{line:46,column:3}},"25":{start:{line:54,column:2},end:{line:54,column:32}},"26":{start:{line:54,column:26},end:{line:54,column:32}},"27":{start:{line:56,column:41},end:{line:56,column:58}},"28":{start:{line:58,column:14},end:{line:58,column:16}},"29":{start:{line:59,column:2},end:{line:69,column:3}},"30":{start:{line:59,column:21},end:{line:59,column:22}},"31":{start:{line:60,column:19},end:{line:60,column:51}},"32":{start:{line:62,column:6},end:{line:62,column:61}},"33":{start:{line:64,column:4},end:{line:64,column:46}},"34":{start:{line:65,column:4},end:{line:68,column:5}},"35":{start:{line:66,column:6},end:{line:66,column:38}},"36":{start:{line:67,column:6},end:{line:67,column:16}},"37":{start:{line:70,column:2},end:{line:70,column:34}},"38":{start:{line:78,column:2},end:{line:78,column:35}},"39":{start:{line:78,column:29},end:{line:78,column:35}},"40":{start:{line:80,column:41},end:{line:80,column:61}},"41":{start:{line:81,column:14},end:{line:81,column:16}},"42":{start:{line:82,column:2},end:{line:93,column:3}},"43":{start:{line:82,column:21},end:{line:82,column:22}},"44":{start:{line:83,column:19},end:{line:83,column:68}},"45":{start:{line:85,column:6},end:{line:85,column:61}},"46":{start:{line:86,column:4},end:{line:86,column:50}},"47":{start:{line:88,column:4},end:{line:88,column:46}},"48":{start:{line:89,column:4},end:{line:92,column:5}},"49":{start:{line:90,column:6},end:{line:90,column:38}},"50":{start:{line:91,column:6},end:{line:91,column:16}},"51":{start:{line:94,column:2},end:{line:94,column:34}},"52":{start:{line:98,column:2},end:{line:104,column:3}},"53":{start:{line:100,column:6},end:{line:100,column:71}},"54":{start:{line:101,column:6},end:{line:101,column:21}},"55":{start:{line:102,column:6},end:{line:102,column:29}},"56":{start:{line:107,column:17},end:{line:107,column:18}},"57":{start:{line:113,column:2},end:{line:133,column:3}},"58":{start:{line:114,column:30},end:{line:114,column:80}},"59":{start:{line:115,column:4},end:{line:115,column:79}},"60":{start:{line:117,column:4},end:{line:117,column:21}},"61":{start:{line:118,column:4},end:{line:130,column:5}},"62":{start:{line:124,column:6},end:{line:128,column:7}},"63":{start:{line:129,column:6},end:{line:129,column:12}},"64":{start:{line:132,column:4},end:{line:132,column:13}},"65":{start:{line:136,column:0},end:{line:138,column:1}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:10,column:36},end:{line:10,column:37}},loc:{start:{line:11,column:2},end:{line:13,column:3}},line:11},"1":{name:"generateCartDiscounts",decl:{start:{line:16,column:15},end:{line:16,column:36}},loc:{start:{line:16,column:54},end:{line:40,column:1}},line:16},"2":{name:"getTotalAmount",decl:{start:{line:42,column:9},end:{line:42,column:23}},loc:{start:{line:42,column:32},end:{line:47,column:1}},line:42},"3":{name:"generateCartDiscountsThatAppliesToAllCarts",decl:{start:{line:49,column:15},end:{line:49,column:57}},loc:{start:{line:53,column:2},end:{line:71,column:1}},line:53},"4":{name:"generateCartDiscountsThatRequiresDiscountCode",decl:{start:{line:73,column:15},end:{line:73,column:60}},loc:{start:{line:77,column:2},end:{line:95,column:1}},line:77},"5":{name:"executeBatch",decl:{start:{line:97,column:15},end:{line:97,column:27}},loc:{start:{line:97,column:42},end:{line:105,column:1}},line:97},"6":{name:"(anonymous_6)",decl:{start:{line:99,column:14},end:{line:99,column:15}},loc:{start:{line:99,column:56},end:{line:103,column:5}},line:99},"7":{name:"buildDraftAndCreateCartDiscount",decl:{start:{line:108,column:15},end:{line:108,column:46}},loc:{start:{line:112,column:2},end:{line:134,column:1}},line:112}},branchMap:{"0":{loc:{start:{line:16,column:37},end:{line:16,column:52}},type:"default-arg",locations:[{start:{line:16,column:49},end:{line:16,column:52}}],line:16},"1":{loc:{start:{line:21,column:2},end:{line:21,column:52}},type:"if",locations:[{start:{line:21,column:2},end:{line:21,column:52}},{start:{line:21,column:2},end:{line:21,column:52}}],line:21},"2":{loc:{start:{line:44,column:5},end:{line:44,column:46}},type:"binary-expr",locations:[{start:{line:44,column:5},end:{line:44,column:41}},{start:{line:44,column:45},end:{line:44,column:46}}],line:44},"3":{loc:{start:{line:45,column:5},end:{line:45,column:43}},type:"binary-expr",locations:[{start:{line:45,column:5},end:{line:45,column:38}},{start:{line:45,column:42},end:{line:45,column:43}}],line:45},"4":{loc:{start:{line:54,column:2},end:{line:54,column:32}},type:"if",locations:[{start:{line:54,column:2},end:{line:54,column:32}},{start:{line:54,column:2},end:{line:54,column:32}}],line:54},"5":{loc:{start:{line:65,column:4},end:{line:68,column:5}},type:"if",locations:[{start:{line:65,column:4},end:{line:68,column:5}},{start:{line:65,column:4},end:{line:68,column:5}}],line:65},"6":{loc:{start:{line:78,column:2},end:{line:78,column:35}},type:"if",locations:[{start:{line:78,column:2},end:{line:78,column:35}},{start:{line:78,column:2},end:{line:78,column:35}}],line:78},"7":{loc:{start:{line:89,column:4},end:{line:92,column:5}},type:"if",locations:[{start:{line:89,column:4},end:{line:92,column:5}},{start:{line:89,column:4},end:{line:92,column:5}}],line:89},"8":{loc:{start:{line:111,column:2},end:{line:111,column:18}},type:"default-arg",locations:[{start:{line:111,column:17},end:{line:111,column:18}}],line:111},"9":{loc:{start:{line:118,column:4},end:{line:130,column:5}},type:"if",locations:[{start:{line:118,column:4},end:{line:130,column:5}},{start:{line:118,column:4},end:{line:130,column:5}}],line:118},"10":{loc:{start:{line:119,column:6},end:{line:122,column:30}},type:"binary-expr",locations:[{start:{line:119,column:6},end:{line:119,column:29}},{start:{line:120,column:7},end:{line:120,column:29}},{start:{line:121,column:8},end:{line:121,column:30}},{start:{line:122,column:8},end:{line:122,column:29}}],line:119}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0],"9":[0,0],"10":[0,0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"ff7acf481b0eb2d0bf7ef01d6c65bbd89983cb3c"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_9z7cltjdy=function(){return actualCoverage;};}return actualCoverage;}cov_9z7cltjdy();const ProgressLog=(cov_9z7cltjdy().s[0]++,require('../progress-log'));const{fetchCartDiscountsConfig}=(cov_9z7cltjdy().s[1]++,require('../custom-object'));const{apiRoot}=(cov_9z7cltjdy().s[2]++,require('../client'));const logger=(cov_9z7cltjdy().s[3]++,require('../logger').getLogger());const{validateConfig}=(cov_9z7cltjdy().s[4]++,require('../validator'));const{buildCartDiscountDraft}=(cov_9z7cltjdy().s[5]++,require('./draft-builder'));const{randomWord}=(cov_9z7cltjdy().s[6]++,require('../random'));const schema=(cov_9z7cltjdy().s[7]++,require('./schema.json'));const progressLog=(cov_9z7cltjdy().s[8]++,new ProgressLog((progress,processed,total)=>{cov_9z7cltjdy().f[0]++;cov_9z7cltjdy().s[9]++;return logger.info(`Progress on cart discount data generation: ${progress}% (${processed}/${total}).`);}));async function generateCartDiscounts(batchSize=(cov_9z7cltjdy().b[0][0]++,100)){cov_9z7cltjdy().f[1]++;const startDate=(cov_9z7cltjdy().s[10]++,new Date());const config=(cov_9z7cltjdy().s[11]++,await fetchCartDiscountsConfig());const validationResult=(cov_9z7cltjdy().s[12]++,validateConfig(schema,config));cov_9z7cltjdy().s[13]++;if(validationResult.skip){cov_9z7cltjdy().b[1][0]++;cov_9z7cltjdy().s[14]++;return validationResult;}else{cov_9z7cltjdy().b[1][1]++;}cov_9z7cltjdy().s[15]++;logger.info({config},`The cart discount data generation is started`);const stats=(cov_9z7cltjdy().s[16]++,{created:0});cov_9z7cltjdy().s[17]++;progressLog.setTotal(getTotalAmount(config));cov_9z7cltjdy().s[18]++;await generateCartDiscountsThatAppliesToAllCarts(config,stats,batchSize);cov_9z7cltjdy().s[19]++;await generateCartDiscountsThatRequiresDiscountCode(config,stats,batchSize);cov_9z7cltjdy().s[20]++;logger.info('The cart discount data generation is completed.');const endDate=(cov_9z7cltjdy().s[21]++,new Date());cov_9z7cltjdy().s[22]++;stats.executionTimeInSeconds=Math.floor(Math.abs(endDate-startDate)/1000);cov_9z7cltjdy().s[23]++;return stats;}function getTotalAmount(config){cov_9z7cltjdy().f[2]++;cov_9z7cltjdy().s[24]++;return((cov_9z7cltjdy().b[2][0]++,config?.requiresDiscountCode?.amount)||(cov_9z7cltjdy().b[2][1]++,0))+((cov_9z7cltjdy().b[3][0]++,config?.appliesToAllCarts?.amount)||(cov_9z7cltjdy().b[3][1]++,0));}async function generateCartDiscountsThatAppliesToAllCarts({appliesToAllCarts},stats,batchSize){cov_9z7cltjdy().f[3]++;cov_9z7cltjdy().s[25]++;if(!appliesToAllCarts){cov_9z7cltjdy().b[4][0]++;cov_9z7cltjdy().s[26]++;return;}else{cov_9z7cltjdy().b[4][1]++;}const{amount,cartDiscountDrafts}=(cov_9z7cltjdy().s[27]++,appliesToAllCarts);let batch=(cov_9z7cltjdy().s[28]++,[]);cov_9z7cltjdy().s[29]++;for(let counter=(cov_9z7cltjdy().s[30]++,1);counter<=amount;counter++){const prefix=(cov_9z7cltjdy().s[31]++,`${randomWord()}_all_${counter}`);const cartDiscountValues=(cov_9z7cltjdy().s[32]++,cartDiscountDrafts[counter%cartDiscountDrafts.length]);cov_9z7cltjdy().s[33]++;batch.push({prefix,cartDiscountValues});cov_9z7cltjdy().s[34]++;if(batch.length===batchSize){cov_9z7cltjdy().b[5][0]++;cov_9z7cltjdy().s[35]++;await executeBatch(batch,stats);cov_9z7cltjdy().s[36]++;batch=[];}else{cov_9z7cltjdy().b[5][1]++;}}cov_9z7cltjdy().s[37]++;await executeBatch(batch,stats);}async function generateCartDiscountsThatRequiresDiscountCode({requiresDiscountCode},stats,batchSize){cov_9z7cltjdy().f[4]++;cov_9z7cltjdy().s[38]++;if(!requiresDiscountCode){cov_9z7cltjdy().b[6][0]++;cov_9z7cltjdy().s[39]++;return;}else{cov_9z7cltjdy().b[6][1]++;}const{amount,cartDiscountDrafts}=(cov_9z7cltjdy().s[40]++,requiresDiscountCode);let batch=(cov_9z7cltjdy().s[41]++,[]);cov_9z7cltjdy().s[42]++;for(let counter=(cov_9z7cltjdy().s[43]++,1);counter<=amount;counter++){const prefix=(cov_9z7cltjdy().s[44]++,`${randomWord()}_requiresDiscountCode_${counter}`);const cartDiscountValues=(cov_9z7cltjdy().s[45]++,cartDiscountDrafts[counter%cartDiscountDrafts.length]);cov_9z7cltjdy().s[46]++;cartDiscountValues.requiresDiscountCode=true;cov_9z7cltjdy().s[47]++;batch.push({prefix,cartDiscountValues});cov_9z7cltjdy().s[48]++;if(batch.length===batchSize){cov_9z7cltjdy().b[7][0]++;cov_9z7cltjdy().s[49]++;await executeBatch(batch,stats);cov_9z7cltjdy().s[50]++;batch=[];}else{cov_9z7cltjdy().b[7][1]++;}}cov_9z7cltjdy().s[51]++;await executeBatch(batch,stats);}async function executeBatch(batch,stats){cov_9z7cltjdy().f[5]++;cov_9z7cltjdy().s[52]++;await Promise.all(batch.map(async({prefix,cartDiscountValues})=>{cov_9z7cltjdy().f[6]++;cov_9z7cltjdy().s[53]++;await buildDraftAndCreateCartDiscount(prefix,cartDiscountValues);cov_9z7cltjdy().s[54]++;stats.created++;cov_9z7cltjdy().s[55]++;progressLog.increment();}));}const maxRetry=(cov_9z7cltjdy().s[56]++,5);async function buildDraftAndCreateCartDiscount(prefix,cartDiscountValues,retryCounter=(cov_9z7cltjdy().b[8][0]++,0)){cov_9z7cltjdy().f[7]++;cov_9z7cltjdy().s[57]++;try{const cartDiscountDraft=(cov_9z7cltjdy().s[58]++,buildCartDiscountDraft(prefix,cartDiscountValues));cov_9z7cltjdy().s[59]++;await apiRoot().cartDiscounts().post({body:cartDiscountDraft}).execute();}catch(err){cov_9z7cltjdy().s[60]++;logger.error(err);cov_9z7cltjdy().s[61]++;if((cov_9z7cltjdy().b[10][0]++,retryCounter<maxRetry)&&((cov_9z7cltjdy().b[10][1]++,err.statusCode===400)||(cov_9z7cltjdy().b[10][2]++,err.statusCode===409)||(cov_9z7cltjdy().b[10][3]++,err.statusCode>=500))){cov_9z7cltjdy().b[9][0]++;cov_9z7cltjdy().s[62]++;await buildDraftAndCreateCartDiscount(prefix,cartDiscountValues,++retryCounter);cov_9z7cltjdy().s[63]++;return;}else{cov_9z7cltjdy().b[9][1]++;}cov_9z7cltjdy().s[64]++;throw err;}}cov_9z7cltjdy().s[65]++;module.exports={generateCartDiscounts};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQcm9ncmVzc0xvZyIsInJlcXVpcmUiLCJmZXRjaENhcnREaXNjb3VudHNDb25maWciLCJhcGlSb290IiwibG9nZ2VyIiwiZ2V0TG9nZ2VyIiwidmFsaWRhdGVDb25maWciLCJidWlsZENhcnREaXNjb3VudERyYWZ0IiwicmFuZG9tV29yZCIsInNjaGVtYSIsInByb2dyZXNzTG9nIiwicHJvZ3Jlc3MiLCJwcm9jZXNzZWQiLCJ0b3RhbCIsImluZm8iLCJnZW5lcmF0ZUNhcnREaXNjb3VudHMiLCJiYXRjaFNpemUiLCJzdGFydERhdGUiLCJEYXRlIiwiY29uZmlnIiwidmFsaWRhdGlvblJlc3VsdCIsInNraXAiLCJzdGF0cyIsImNyZWF0ZWQiLCJzZXRUb3RhbCIsImdldFRvdGFsQW1vdW50IiwiZ2VuZXJhdGVDYXJ0RGlzY291bnRzVGhhdEFwcGxpZXNUb0FsbENhcnRzIiwiZ2VuZXJhdGVDYXJ0RGlzY291bnRzVGhhdFJlcXVpcmVzRGlzY291bnRDb2RlIiwiZW5kRGF0ZSIsImV4ZWN1dGlvblRpbWVJblNlY29uZHMiLCJNYXRoIiwiZmxvb3IiLCJhYnMiLCJyZXF1aXJlc0Rpc2NvdW50Q29kZSIsImFtb3VudCIsImFwcGxpZXNUb0FsbENhcnRzIiwiY2FydERpc2NvdW50RHJhZnRzIiwiYmF0Y2giLCJjb3VudGVyIiwicHJlZml4IiwiY2FydERpc2NvdW50VmFsdWVzIiwibGVuZ3RoIiwicHVzaCIsImV4ZWN1dGVCYXRjaCIsIlByb21pc2UiLCJhbGwiLCJtYXAiLCJidWlsZERyYWZ0QW5kQ3JlYXRlQ2FydERpc2NvdW50IiwiaW5jcmVtZW50IiwibWF4UmV0cnkiLCJyZXRyeUNvdW50ZXIiLCJjYXJ0RGlzY291bnREcmFmdCIsImNhcnREaXNjb3VudHMiLCJwb3N0IiwiYm9keSIsImV4ZWN1dGUiLCJlcnIiLCJlcnJvciIsInN0YXR1c0NvZGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiaW1wb3J0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUHJvZ3Jlc3NMb2cgPSByZXF1aXJlKCcuLi9wcm9ncmVzcy1sb2cnKVxuY29uc3QgeyBmZXRjaENhcnREaXNjb3VudHNDb25maWcgfSA9IHJlcXVpcmUoJy4uL2N1c3RvbS1vYmplY3QnKVxuY29uc3QgeyBhcGlSb290IH0gPSByZXF1aXJlKCcuLi9jbGllbnQnKVxuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vbG9nZ2VyJykuZ2V0TG9nZ2VyKClcbmNvbnN0IHsgdmFsaWRhdGVDb25maWcgfSA9IHJlcXVpcmUoJy4uL3ZhbGlkYXRvcicpXG5jb25zdCB7IGJ1aWxkQ2FydERpc2NvdW50RHJhZnQgfSA9IHJlcXVpcmUoJy4vZHJhZnQtYnVpbGRlcicpXG5jb25zdCB7IHJhbmRvbVdvcmQgfSA9IHJlcXVpcmUoJy4uL3JhbmRvbScpXG5jb25zdCBzY2hlbWEgPSByZXF1aXJlKCcuL3NjaGVtYS5qc29uJylcblxuY29uc3QgcHJvZ3Jlc3NMb2cgPSBuZXcgUHJvZ3Jlc3NMb2coKHByb2dyZXNzLCBwcm9jZXNzZWQsIHRvdGFsKSA9PlxuICBsb2dnZXIuaW5mbyhcbiAgICBgUHJvZ3Jlc3Mgb24gY2FydCBkaXNjb3VudCBkYXRhIGdlbmVyYXRpb246ICR7cHJvZ3Jlc3N9JSAoJHtwcm9jZXNzZWR9LyR7dG90YWx9KS5gXG4gIClcbilcblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVDYXJ0RGlzY291bnRzKGJhdGNoU2l6ZSA9IDEwMCkge1xuICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSgpXG5cbiAgY29uc3QgY29uZmlnID0gYXdhaXQgZmV0Y2hDYXJ0RGlzY291bnRzQ29uZmlnKClcbiAgY29uc3QgdmFsaWRhdGlvblJlc3VsdCA9IHZhbGlkYXRlQ29uZmlnKHNjaGVtYSwgY29uZmlnKVxuICBpZiAodmFsaWRhdGlvblJlc3VsdC5za2lwKSByZXR1cm4gdmFsaWRhdGlvblJlc3VsdFxuXG4gIGxvZ2dlci5pbmZvKHsgY29uZmlnIH0sIGBUaGUgY2FydCBkaXNjb3VudCBkYXRhIGdlbmVyYXRpb24gaXMgc3RhcnRlZGApXG4gIGNvbnN0IHN0YXRzID0ge1xuICAgIGNyZWF0ZWQ6IDAsXG4gIH1cblxuICBwcm9ncmVzc0xvZy5zZXRUb3RhbChnZXRUb3RhbEFtb3VudChjb25maWcpKVxuXG4gIGF3YWl0IGdlbmVyYXRlQ2FydERpc2NvdW50c1RoYXRBcHBsaWVzVG9BbGxDYXJ0cyhjb25maWcsIHN0YXRzLCBiYXRjaFNpemUpXG4gIGF3YWl0IGdlbmVyYXRlQ2FydERpc2NvdW50c1RoYXRSZXF1aXJlc0Rpc2NvdW50Q29kZShjb25maWcsIHN0YXRzLCBiYXRjaFNpemUpXG5cbiAgbG9nZ2VyLmluZm8oJ1RoZSBjYXJ0IGRpc2NvdW50IGRhdGEgZ2VuZXJhdGlvbiBpcyBjb21wbGV0ZWQuJylcbiAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKClcbiAgc3RhdHMuZXhlY3V0aW9uVGltZUluU2Vjb25kcyA9IE1hdGguZmxvb3IoXG4gICAgTWF0aC5hYnMoZW5kRGF0ZSAtIHN0YXJ0RGF0ZSkgLyAxMDAwXG4gIClcblxuICByZXR1cm4gc3RhdHNcbn1cblxuZnVuY3Rpb24gZ2V0VG90YWxBbW91bnQoY29uZmlnKSB7XG4gIHJldHVybiAoXG4gICAgKGNvbmZpZz8ucmVxdWlyZXNEaXNjb3VudENvZGU/LmFtb3VudCB8fCAwKSArXG4gICAgKGNvbmZpZz8uYXBwbGllc1RvQWxsQ2FydHM/LmFtb3VudCB8fCAwKVxuICApXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlQ2FydERpc2NvdW50c1RoYXRBcHBsaWVzVG9BbGxDYXJ0cyhcbiAgeyBhcHBsaWVzVG9BbGxDYXJ0cyB9LFxuICBzdGF0cyxcbiAgYmF0Y2hTaXplXG4pIHtcbiAgaWYgKCFhcHBsaWVzVG9BbGxDYXJ0cykgcmV0dXJuXG5cbiAgY29uc3QgeyBhbW91bnQsIGNhcnREaXNjb3VudERyYWZ0cyB9ID0gYXBwbGllc1RvQWxsQ2FydHNcblxuICBsZXQgYmF0Y2ggPSBbXVxuICBmb3IgKGxldCBjb3VudGVyID0gMTsgY291bnRlciA8PSBhbW91bnQ7IGNvdW50ZXIrKykge1xuICAgIGNvbnN0IHByZWZpeCA9IGAke3JhbmRvbVdvcmQoKX1fYWxsXyR7Y291bnRlcn1gXG4gICAgY29uc3QgY2FydERpc2NvdW50VmFsdWVzID1cbiAgICAgIGNhcnREaXNjb3VudERyYWZ0c1tjb3VudGVyICUgY2FydERpc2NvdW50RHJhZnRzLmxlbmd0aF1cblxuICAgIGJhdGNoLnB1c2goeyBwcmVmaXgsIGNhcnREaXNjb3VudFZhbHVlcyB9KVxuICAgIGlmIChiYXRjaC5sZW5ndGggPT09IGJhdGNoU2l6ZSkge1xuICAgICAgYXdhaXQgZXhlY3V0ZUJhdGNoKGJhdGNoLCBzdGF0cylcbiAgICAgIGJhdGNoID0gW11cbiAgICB9XG4gIH1cbiAgYXdhaXQgZXhlY3V0ZUJhdGNoKGJhdGNoLCBzdGF0cylcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVDYXJ0RGlzY291bnRzVGhhdFJlcXVpcmVzRGlzY291bnRDb2RlKFxuICB7IHJlcXVpcmVzRGlzY291bnRDb2RlIH0sXG4gIHN0YXRzLFxuICBiYXRjaFNpemVcbikge1xuICBpZiAoIXJlcXVpcmVzRGlzY291bnRDb2RlKSByZXR1cm5cblxuICBjb25zdCB7IGFtb3VudCwgY2FydERpc2NvdW50RHJhZnRzIH0gPSByZXF1aXJlc0Rpc2NvdW50Q29kZVxuICBsZXQgYmF0Y2ggPSBbXVxuICBmb3IgKGxldCBjb3VudGVyID0gMTsgY291bnRlciA8PSBhbW91bnQ7IGNvdW50ZXIrKykge1xuICAgIGNvbnN0IHByZWZpeCA9IGAke3JhbmRvbVdvcmQoKX1fcmVxdWlyZXNEaXNjb3VudENvZGVfJHtjb3VudGVyfWBcbiAgICBjb25zdCBjYXJ0RGlzY291bnRWYWx1ZXMgPVxuICAgICAgY2FydERpc2NvdW50RHJhZnRzW2NvdW50ZXIgJSBjYXJ0RGlzY291bnREcmFmdHMubGVuZ3RoXVxuICAgIGNhcnREaXNjb3VudFZhbHVlcy5yZXF1aXJlc0Rpc2NvdW50Q29kZSA9IHRydWVcblxuICAgIGJhdGNoLnB1c2goeyBwcmVmaXgsIGNhcnREaXNjb3VudFZhbHVlcyB9KVxuICAgIGlmIChiYXRjaC5sZW5ndGggPT09IGJhdGNoU2l6ZSkge1xuICAgICAgYXdhaXQgZXhlY3V0ZUJhdGNoKGJhdGNoLCBzdGF0cylcbiAgICAgIGJhdGNoID0gW11cbiAgICB9XG4gIH1cbiAgYXdhaXQgZXhlY3V0ZUJhdGNoKGJhdGNoLCBzdGF0cylcbn1cblxuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUJhdGNoKGJhdGNoLCBzdGF0cykge1xuICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICBiYXRjaC5tYXAoYXN5bmMgKHsgcHJlZml4LCBjYXJ0RGlzY291bnRWYWx1ZXMgfSkgPT4ge1xuICAgICAgYXdhaXQgYnVpbGREcmFmdEFuZENyZWF0ZUNhcnREaXNjb3VudChwcmVmaXgsIGNhcnREaXNjb3VudFZhbHVlcylcbiAgICAgIHN0YXRzLmNyZWF0ZWQrK1xuICAgICAgcHJvZ3Jlc3NMb2cuaW5jcmVtZW50KClcbiAgICB9KVxuICApXG59XG5cbmNvbnN0IG1heFJldHJ5ID0gNVxuYXN5bmMgZnVuY3Rpb24gYnVpbGREcmFmdEFuZENyZWF0ZUNhcnREaXNjb3VudChcbiAgcHJlZml4LFxuICBjYXJ0RGlzY291bnRWYWx1ZXMsXG4gIHJldHJ5Q291bnRlciA9IDBcbikge1xuICB0cnkge1xuICAgIGNvbnN0IGNhcnREaXNjb3VudERyYWZ0ID0gYnVpbGRDYXJ0RGlzY291bnREcmFmdChwcmVmaXgsIGNhcnREaXNjb3VudFZhbHVlcylcbiAgICBhd2FpdCBhcGlSb290KCkuY2FydERpc2NvdW50cygpLnBvc3QoeyBib2R5OiBjYXJ0RGlzY291bnREcmFmdCB9KS5leGVjdXRlKClcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmVycm9yKGVycilcbiAgICBpZiAoXG4gICAgICByZXRyeUNvdW50ZXIgPCBtYXhSZXRyeSAmJlxuICAgICAgKGVyci5zdGF0dXNDb2RlID09PSA0MDAgfHxcbiAgICAgICAgZXJyLnN0YXR1c0NvZGUgPT09IDQwOSB8fFxuICAgICAgICBlcnIuc3RhdHVzQ29kZSA+PSA1MDApXG4gICAgKSB7XG4gICAgICBhd2FpdCBidWlsZERyYWZ0QW5kQ3JlYXRlQ2FydERpc2NvdW50KFxuICAgICAgICBwcmVmaXgsXG4gICAgICAgIGNhcnREaXNjb3VudFZhbHVlcyxcbiAgICAgICAgKytyZXRyeUNvdW50ZXJcbiAgICAgIClcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRocm93IGVyclxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBnZW5lcmF0ZUNhcnREaXNjb3VudHMsXG59XG4iXSwibWFwcGluZ3MiOiJpeFFBZVk7eUZBZlosS0FBTUEsWUFBVyx5QkFBR0MsT0FBTyxDQUFDLGlCQUFELENBQVYsQ0FBakIsQ0FDQSxLQUFNLENBQUVDLHdCQUFGLDBCQUErQkQsT0FBTyxDQUFDLGtCQUFELENBQXRDLENBQU4sQ0FDQSxLQUFNLENBQUVFLE9BQUYsMEJBQWNGLE9BQU8sQ0FBQyxXQUFELENBQXJCLENBQU4sQ0FDQSxLQUFNRyxPQUFNLHlCQUFHSCxPQUFPLENBQUMsV0FBRCxDQUFQLENBQXFCSSxTQUFyQixFQUFILENBQVosQ0FDQSxLQUFNLENBQUVDLGNBQUYsMEJBQXFCTCxPQUFPLENBQUMsY0FBRCxDQUE1QixDQUFOLENBQ0EsS0FBTSxDQUFFTSxzQkFBRiwwQkFBNkJOLE9BQU8sQ0FBQyxpQkFBRCxDQUFwQyxDQUFOLENBQ0EsS0FBTSxDQUFFTyxVQUFGLDBCQUFpQlAsT0FBTyxDQUFDLFdBQUQsQ0FBeEIsQ0FBTixDQUNBLEtBQU1RLE9BQU0seUJBQUdSLE9BQU8sQ0FBQyxlQUFELENBQVYsQ0FBWixDQUVBLEtBQU1TLFlBQVcseUJBQUcsR0FBSVYsWUFBSixDQUFnQixDQUFDVyxRQUFELENBQVdDLFNBQVgsQ0FBc0JDLEtBQXRCLEdBQ2xDLHFEQUFBVCxPQUFNLENBQUNVLElBQVAsQ0FDRyw4Q0FBNkNILFFBQVMsTUFBS0MsU0FBVSxJQUFHQyxLQUFNLElBRGpGLEVB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